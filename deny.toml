# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/

[graph]
# Target platforms to check
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    "x86_64-pc-windows-msvc",
]

# =============================================================================
# Licenses
# =============================================================================
[licenses]
# Confidence threshold for detecting a license
confidence-threshold = 0.93

# List of allowed licenses
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Zlib",
    "MPL-2.0",
    "Unicode-DFS-2016",
    "CC0-1.0",
    "Unlicense",
]

# Clarify licenses for specific crates
[[licenses.clarify]]
name = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

[[licenses.clarify]]
name = "webpki"
expression = "ISC"
license-files = [{ path = "LICENSE", hash = 0x001c7e6c }]

# =============================================================================
# Bans
# =============================================================================
[bans]
# Lint level for multiple versions of the same crate
multiple-versions = "warn"
wildcards = "allow"

# Crates to deny entirely
deny = [
    # Avoid openssl in favor of rustls
    # { name = "openssl" },
    # { name = "openssl-sys" },
]

# Allow specific duplicate versions if needed
skip = []

# =============================================================================
# Advisories
# =============================================================================
[advisories]
# Path to the advisory database
db-path = "~/.cargo/advisory-db"

# URL to the advisory database
db-urls = ["https://github.com/rustsec/advisory-db"]

# Lint level for security vulnerabilities
vulnerability = "deny"

# Lint level for unmaintained crates
unmaintained = "warn"

# Lint level for yanked crates
yanked = "warn"

# Ignore specific advisories
# These are transitive dependencies we cannot directly update
ignore = [
    # instant is unmaintained, but comes from iggy -> reqwest-retry -> parking_lot v0.11.2
    # Upstream needs to update parking_lot to v0.12+
    "RUSTSEC-2024-0384",

    # rustls-pemfile is unmaintained, but comes from testcontainers -> bollard (dev-dependency only)
    # Upstream needs to migrate to rustls-pki-types
    "RUSTSEC-2025-0134",

    # paste is unmaintained, but comes from iggy -> iggy_common -> compio-io
    # Upstream (iggy/compio) needs to migrate to pastey or alternative
    "RUSTSEC-2024-0436",
]

# =============================================================================
# Sources
# =============================================================================
[sources]
# Lint level for unknown registries
unknown-registry = "deny"

# Lint level for unknown git sources
unknown-git = "warn"

# Allowed registries
allow-registry = ["https://github.com/rust-lang/crates.io-index"]

# Allowed git repositories (add if using git dependencies)
allow-git = []
